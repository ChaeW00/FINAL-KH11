<?xml version="1.0" encoding="UTF-8"?>

<!-- DOCTYPE 설정을 통해 자동완성 + 문법검사 수행 -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 
	mapper 내부에 SQL 구문을 배치
	- namespace : 외부에서 부르기 위한 별칭(테이블명으로 작성)
-->
<mapper namespace="plan">

		<!-- 시퀀스 발행 -->
  		<select id="sequence" resultType="int">
  			select plan_seq.nextval from dual
  		</select>
  		
  		<!-- 아지트 번호로 스케줄 목록 검색하여 출력 -->
  		<select id="list" parameterType="int" resultType="PlanDto">
  			select plan_no, team_member_no, team_no, plan_title, 
  			to_char(plan_start, 'YYYY-MM-DD HH24:MI:SS') plan_start, 
  			to_char(plan_end, 'YYYY-MM-DD HH24:MI:SS') plan_end,  
  			plan_allday from plan where team_no=#{teamNo} 
  			order by plan_start asc
  		</select>
  		
  		<!-- 아지트 번호로 스케줄 목록 검색하여 출력(사이드바 용도) -->
  		<select id="listSysdate" parameterType="int" resultType="PlanDto">
  			select plan_no, team_member_no, team_no, plan_title, 
  			to_char(plan_start, 'YYYY-MM-DD HH24:MI:SS') plan_start, 
  			to_char(plan_end, 'YYYY-MM-DD HH24:MI:SS') plan_end,  
  			plan_allday from plan where team_no=#{teamNo} 
  			and plan_start>=sysdate order by plan_start asc
  		</select>
  		
  		<!-- 스케줄 출력 리스트(board 페이지에서 상위 3개 노출) -->
  		<select id="listRownum" parameterType="int" resultType="PlanDto">
  		 <![CDATA[
  			select*from (
			select plan_no, team_member_no, team_no, plan_title, 
			  			to_char(plan_start, 'YYYY-MM-DD HH24:MI:SS') plan_start, 
			  			to_char(plan_end, 'YYYY-MM-DD HH24:MI:SS') plan_end,  
			  			plan_allday from plan where team_no=#{teamNo} and plan_start>=sysdate order by plan_start asc
  			) 
  			where rownum<=3
  			 ]]>
  		</select>
  		
  		<!-- 로그인한 유저가 일정페이지에서 스케줄 입력 -->
  		<insert id="insert" parameterType="PlanDto">
  			insert into plan values(plan_seq.nextval, #{teamMemberNo}, #{teamNo}, #{planTitle}, to_date(#{planStart},'YYYY-MM-DD HH24:MI:SS'), to_date(#{planEnd},'YYYY-MM-DD HH24:MI:SS'), #{planAllday});
  		</insert>
  		
  		<!-- 스케줄 입력(시퀀스번호 미리발행 -->
		<insert id="insert2" parameterType="PlanDto">
			insert into plan(plan_no, team_member_no, team_no, plan_title, plan_start, plan_end, plan_allday) values(#{planNo}, #{teamMemberNo}, #{teamNo}, #{planTitle}, to_date(#{planStart},'YYYY-MM-DD HH24:MI:SS'), to_date(#{planEnd},'YYYY-MM-DD HH24:MI:SS'), #{planAllday})
		</insert>
		
		<!-- 스케줄 삭제 -->
		<delete id="delete" parameterType="int">
			delete plan where plan_no=#{planNo}
		</delete>
		
		
</mapper>